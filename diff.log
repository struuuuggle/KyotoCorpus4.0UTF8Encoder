# diff.log

3c3
< # ¹½Ê¸²òÀÏ·ë²Ì¤ÎÌÚ¹½Â¤É½¼¨
---
> # æ§‹æ–‡è§£æçµæœã®æœ¨æ§‹é€ è¡¨ç¤º
8,28c8,30
< use encoding 'euc-jp';
< 
< $pos_mark{"ÆÃ¼ì"} =  '*';
< $pos_mark{"Æ°»ì"} =  'v';
< $pos_mark{"·ÁÍÆ»ì"} =  'j';
< $pos_mark{"È½Äê»ì"} =  'c';
< $pos_mark{"½õÆ°»ì"} =  'x';
< $pos_mark{"Ì¾»ì"} =  'n';
< $pos_mark{"¸ÇÍ­Ì¾»ì"} =  'N';	# ÆÃÊÌ
< $pos_mark{"¿ÍÌ¾"} =  'J';	# ÆÃÊÌ
< $pos_mark{"ÃÏÌ¾"} =  'C';	# ÆÃÊÌ
< $pos_mark{"ÁÈ¿¥Ì¾"} =  'A';	# ÆÃÊÌ
< $pos_mark{"»Ø¼¨»ì"} =  'd';
< $pos_mark{"Éû»ì"} =  'a';
< $pos_mark{"½õ»ì"} =  'p';
< $pos_mark{"ÀÜÂ³»ì"} =  'c';
< $pos_mark{"Ï¢ÂÎ»ì"} =  'm';
< $pos_mark{"´¶Æ°»ì"} =  '!';
< $pos_mark{"ÀÜÆ¬¼­"} =  'p';
< $pos_mark{"ÀÜÈø¼­"} =  's';
< $pos_mark{"Ì¤ÄêµÁ¸ì"} =  '?';
---
> use utf8;
> open IO => ":encoding(utf-8)";
> use open ":std";
> 
> $pos_mark{"ç‰¹æ®Š"} =  '*';
> $pos_mark{"å‹•è©"} =  'v';
> $pos_mark{"å½¢å®¹è©"} =  'j';
> $pos_mark{"åˆ¤å®šè©"} =  'c';
> $pos_mark{"åŠ©å‹•è©"} =  'x';
> $pos_mark{"åè©"} =  'n';
> $pos_mark{"å›ºæœ‰åè©"} =  'N';	# ç‰¹åˆ¥
> $pos_mark{"äººå"} =  'J';	# ç‰¹åˆ¥
> $pos_mark{"åœ°å"} =  'C';	# ç‰¹åˆ¥
> $pos_mark{"çµ„ç¹”å"} =  'A';	# ç‰¹åˆ¥
> $pos_mark{"æŒ‡ç¤ºè©"} =  'd';
> $pos_mark{"å‰¯è©"} =  'a';
> $pos_mark{"åŠ©è©"} =  'p';
> $pos_mark{"æ¥ç¶šè©"} =  'c';
> $pos_mark{"é€£ä½“è©"} =  'm';
> $pos_mark{"æ„Ÿå‹•è©"} =  '!';
> $pos_mark{"æ¥é ­è¾"} =  'p';
> $pos_mark{"æ¥å°¾è¾"} =  's';
> $pos_mark{"æœªå®šç¾©èª"} =  '?';
31c33
< # ÆşÎÏ
---
> # å…¥åŠ›
43c45
< 	@mark = split(/ /, $1);
---
>   @mark = split(/ /, $1);
45c47
< 	@mark = ();
---
>   @mark = ();
47c49
<     print;	# Ê¸ID¤Î½ĞÎÏ
---
>     print;	# æ–‡IDã®å‡ºåŠ›
50,66c52,68
< 	chop;
< 	if (/^\*/) {
< 	    $mrph_data_start[$mrph_num] = 1;
< 	    $bnst_data_start[$bnst_num] = $mrph_num;
< 	    /^\* [\-0-9]+ ([\-0-9]+)([DPIA])/;	# ÊÑ¹¹ÅÀ
< 	    $bnst_data_dpnd[$bnst_num] = $1;
< 	    $bnst_data_type[$bnst_num] = $2;
< 	    $bnst_num++;
< 	}
< 	elsif (/^EOS/) {
< 	    $bnst_data_start[$bnst_num] = $mrph_num; # ËöÈø¤Î°õ
< 	    last;
< 	}
< 	else {
< 	    @{$mrph_data_all[$mrph_num]} = split;
< 	    $mrph_num++;
< 	}
---
>   chop;
>   if (/^\*/) {
>       $mrph_data_start[$mrph_num] = 1;
>       $bnst_data_start[$bnst_num] = $mrph_num;
>       /^\* [\-0-9]+ ([\-0-9]+)([DPIA])/;	# å¤‰æ›´ç‚¹
>       $bnst_data_dpnd[$bnst_num] = $1;
>       $bnst_data_type[$bnst_num] = $2;
>       $bnst_num++;
>   }
>   elsif (/^EOS/) {
>       $bnst_data_start[$bnst_num] = $mrph_num; # æœ«å°¾ã®å°
>       last;
>   }
>   else {
>       @{$mrph_data_all[$mrph_num]} = split;
>       $mrph_num++;
>   }
70c72
< 	return 1;
---
>   return 1;
72c74
< 	return 0;
---
>   return 0;
77c79
< # ¹ÔÎó¤ËÉ½¼¨¤¹¤ëÊ¸ÀáºîÀ®
---
> # è¡Œåˆ—ã«è¡¨ç¤ºã™ã‚‹æ–‡ç¯€ä½œæˆ
88c90
< 	$line[$i] = &make_bnst_string($i);
---
>   $line[$i] = &make_bnst_string($i);
92c94
< 	$line[$i] = "¡ú" . $line[$i];
---
>   $line[$i] = "â˜…" . $line[$i];
96,103c98,105
< 	for ($j = $i + 1; $j < $bnst_num; $j++) {
< 	    $line[$i] .= $item[$i][$j];
< 	}
< 
< 	$length = do { use bytes; length(encode('euc-jp', $line[$i])) };
< 	if ($max_length <= $length) {
< 	    $max_length = $length;
< 	}
---
>   for ($j = $i + 1; $j < $bnst_num; $j++) {
>       $line[$i] .= $item[$i][$j];
>   }
> 
>   $length = do { use bytes; length(encode('utf8', $line[$i])) };
>   if ($max_length <= $length) {
>       $max_length = $length;
>   }
107,112c109,114
< 	$diff = $max_length - do { use bytes; length(encode('euc-jp', $line[$i])) };
< 	print ' ' x $diff;
< # 	for ($j = 0; $j < $diff; $j++) {
< # 	    print " ";
< # 	}
< 	print "$line[$i]\n";
---
>   $diff = $max_length - do { use bytes; length(encode('utf8', $line[$i])) };
>   print ' ' x $diff;
> #   for ($j = 0; $j < $diff; $j++) {
> #       print " ";
> #   }
>   print "$line[$i]\n";
117c119
< # ¹ÔÎó¤ËÉ½¼¨¤¹¤ëÊ¸ÀáºîÀ®
---
> # è¡Œåˆ—ã«è¡¨ç¤ºã™ã‚‹æ–‡ç¯€ä½œæˆ
125,136c127,138
<     for ($i = $bnst_data_start[$b_num]; 
< 	 $i < $bnst_data_start[$b_num+1]; $i++) {
< 	$string .= $mrph_data_all[$i][0];
< 	# next; ÉÊ»ì¥Ş¡¼¥¯¤òÆş¤ì¤Ê¤¤¾ì¹ç
< 	if ($mrph_data_all[$i][4] eq "¸ÇÍ­Ì¾»ì" ||	# ÊÑ¹¹ÅÀ
< 	    $mrph_data_all[$i][4] eq "¿ÍÌ¾" ||		# ÊÑ¹¹ÅÀ
< 	    $mrph_data_all[$i][4] eq "ÃÏÌ¾" ||		# ÊÑ¹¹ÅÀ
< 	    $mrph_data_all[$i][4] eq "ÁÈ¿¥Ì¾") { 	# ÊÑ¹¹ÅÀ
< 	    $string .= $pos_mark{$mrph_data_all[$i][4]};# ÊÑ¹¹ÅÀ
< 	} else {
< 	    $string .= $pos_mark{$mrph_data_all[$i][3]};
< 	}
---
>     for ($i = $bnst_data_start[$b_num];
>    $i < $bnst_data_start[$b_num+1]; $i++) {
>   $string .= $mrph_data_all[$i][0];
>   # next; å“è©ãƒãƒ¼ã‚¯ã‚’å…¥ã‚Œãªã„å ´åˆ
>   if ($mrph_data_all[$i][4] eq "å›ºæœ‰åè©" ||	# å¤‰æ›´ç‚¹
>       $mrph_data_all[$i][4] eq "äººå" ||		# å¤‰æ›´ç‚¹
>       $mrph_data_all[$i][4] eq "åœ°å" ||		# å¤‰æ›´ç‚¹
>       $mrph_data_all[$i][4] eq "çµ„ç¹”å") {  # å¤‰æ›´ç‚¹
>       $string .= $pos_mark{$mrph_data_all[$i][4]};# å¤‰æ›´ç‚¹
>   } else {
>       $string .= $pos_mark{$mrph_data_all[$i][3]};
>   }
143c145
< # ¹ÔÎó¤Î³Æ¹àÉ½¼¨
---
> # è¡Œåˆ—ã®å„é …è¡¨ç¤º
151c153
< 	$active_column[$i] = 0;
---
>   $active_column[$i] = 0;
156,218c158,220
< 	if ($bnst_data_type[$i] eq "P") {
< 	    $para_row = 1;
< 	} else {
< 	    $para_row = 0;
< 	}
< 
< 	for ($j = $i + 1; $j < $bnst_num; $j++) {
< 
< 	    if ($j < $bnst_data_dpnd[$i]) {
< 		if ($active_column[$j] == 2) {
< 		    if ($para_row == 1) {
< 			$item[$i][$j] = "¨¶";
< 		    } else {
< 			$item[$i][$j] = "¨À";
< 		    }
< 		} elsif ($active_column[$j] == 1) {
< 		    if ($para_row == 1) {
< 			$item[$i][$j] = "¨»";
< 		    } else {
< 			$item[$i][$j] = "¨«";
< 		    }
< 		} else {
< 		    if ($para_row == 1) {
< 			$item[$i][$j] = "¨¬";
< 		    } else {
< 			$item[$i][$j] = "¨¡";
< 		    }
< 		}
< 	    }
< 	    elsif ($j == $bnst_data_dpnd[$i]) {
< 		if ($bnst_data_type[$i] eq "P") {
< 		    $item[$i][$j] = "£Ğ";
< 		} elsif ($bnst_data_type[$i] eq "I") {
< 		    $item[$i][$j] = "£É";
< 		} elsif ($bnst_data_type[$i] eq "A") {
< 		    $item[$i][$j] = "£Á";
< 		} else {
< 		    if ($active_column[$j] == 2) {
< 			$item[$i][$j] = "¨¹";
< 		    } elsif ($active_column[$j] == 1) {
< 			$item[$i][$j] = "¨©";
< 		    } else {
< 			$item[$i][$j] = "¨¤";
< 		    }
< 		}
< 
< 		if ($active_column[$j] == 2) {
< 		    ;		# ¤¹¤Ç¤Ë£Ğ¤«¤é¤ÎÂÀÀş¤¬¤¢¤ì¤Ğ¤½¤Î¤Ş¤Ş
< 		} elsif ($para_row) {
< 		    $active_column[$j] = 2;
< 		} else {
< 		    $active_column[$j] = 1;
< 		}
< 	    } else {
< 		if ($active_column[$j] == 2) {
< 		    $item[$i][$j] = "¨­";
< 		} elsif ($active_column[$j] == 1) {
< 		    $item[$i][$j] = "¨¢";
< 		} else {
< 		    $item[$i][$j] = "¡¡";
< 		}
< 	    }
< 	}
---
>   if ($bnst_data_type[$i] eq "P") {
>       $para_row = 1;
>   } else {
>       $para_row = 0;
>   }
> 
>   for ($j = $i + 1; $j < $bnst_num; $j++) {
> 
>       if ($j < $bnst_data_dpnd[$i]) {
>     if ($active_column[$j] == 2) {
>         if ($para_row == 1) {
>       $item[$i][$j] = "â•‹";
>         } else {
>       $item[$i][$j] = "â•‚";
>         }
>     } elsif ($active_column[$j] == 1) {
>         if ($para_row == 1) {
>       $item[$i][$j] = "â”¿";
>         } else {
>       $item[$i][$j] = "â”¼";
>         }
>     } else {
>         if ($para_row == 1) {
>       $item[$i][$j] = "â”";
>         } else {
>       $item[$i][$j] = "â”€";
>         }
>     }
>       }
>       elsif ($j == $bnst_data_dpnd[$i]) {
>     if ($bnst_data_type[$i] eq "P") {
>         $item[$i][$j] = "ï¼°";
>     } elsif ($bnst_data_type[$i] eq "I") {
>         $item[$i][$j] = "ï¼©";
>     } elsif ($bnst_data_type[$i] eq "A") {
>         $item[$i][$j] = "ï¼¡";
>     } else {
>         if ($active_column[$j] == 2) {
>       $item[$i][$j] = "â”¨";
>         } elsif ($active_column[$j] == 1) {
>       $item[$i][$j] = "â”¤";
>         } else {
>       $item[$i][$j] = "â”";
>         }
>     }
> 
>     if ($active_column[$j] == 2) {
>         ;		# ã™ã§ã«ï¼°ã‹ã‚‰ã®å¤ªç·šãŒã‚ã‚Œã°ãã®ã¾ã¾
>     } elsif ($para_row) {
>         $active_column[$j] = 2;
>     } else {
>         $active_column[$j] = 1;
>     }
>       } else {
>     if ($active_column[$j] == 2) {
>         $item[$i][$j] = "â”ƒ";
>     } elsif ($active_column[$j] == 1) {
>         $item[$i][$j] = "â”‚";
>     } else {
>         $item[$i][$j] = "ã€€";
>     }
>       }
>   }
